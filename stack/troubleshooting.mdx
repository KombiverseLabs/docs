---
title: Troubleshooting
description: Debug and fix common issues with kombify Stack
sidebarTitle: Troubleshooting
icon: bug
---


This guide helps you diagnose and resolve common issues with kombify Stack.

## Quick diagnostics

Run a quick health check:

```bash
# API health
curl http://localhost:5260/api/v1/health

# Detailed server info
curl http://localhost:5260/api/v1/info
```

## Common issues

<AccordionGroup>
  <Accordion title="Cannot connect to Stack API">
    **Symptoms:** Connection refused, timeout
    
    **Solutions:**
    1. Check if Stack is running:
       ```bash
       docker ps | grep kombistack
       # or
       systemctl status kombistack
       ```
    
    2. Verify port is listening:
       ```bash
       netstat -tlnp | grep 5260
       ```
    
    3. Check firewall rules:
       ```bash
       # Linux
       sudo ufw status
       # or
       sudo iptables -L -n | grep 5260
       ```
    
    4. Check Docker logs:
       ```bash
       docker logs kombistack
       ```
  </Accordion>
  
  <Accordion title="Agent not connecting">
    **Symptoms:** Worker shows as `unreachable` or `pending`
    
    **Solutions:**
    1. Verify agent is running on the node:
       ```bash
       systemctl status kombify-agent
       ```
    
    2. Check agent logs:
       ```bash
       journalctl -u kombify-agent -f
       ```
    
    3. Test connectivity from agent to Stack:
       ```bash
       curl -v https://stack-server:5263
       ```
    
    4. Verify certificates:
       ```bash
       openssl s_client -connect stack-server:5263
       ```
    
    5. Check if worker needs approval:
       ```bash
       curl http://localhost:5260/api/v1/workers?status=pending
       ```
  </Accordion>
  
  <Accordion title="Deployment fails during validation">
    **Symptoms:** "Validation failed" error
    
    **Solutions:**
    1. Check your `kombination.yaml` syntax:
       ```bash
       # Validate YAML syntax
       python -c "import yaml; yaml.safe_load(open('kombination.yaml'))"
       ```
    
    2. Get detailed validation errors:
       ```bash
       curl -X POST http://localhost:5260/api/v1/unifier/validate \
         -H "Content-Type: application/yaml" \
         --data-binary @kombination.yaml
       ```
    
    3. Common validation errors:
       - Missing required fields
       - Invalid service names
       - Unsupported StackKit
       - Resource constraints violated
  </Accordion>
  
  <Accordion title="SSL certificate errors">
    **Symptoms:** "certificate verify failed", "unknown CA"
    
    **Solutions:**
    1. For mTLS agent connections, ensure CA is correct:
       ```bash
       # On Stack server
       ls -la /data/certs/
       
       # Verify CA matches
       openssl x509 -in /data/certs/ca.crt -text -noout
       ```
    
    2. Regenerate certificates:
       ```bash
       make certs-init
       make certs-agent AGENT=node-1
       ```
    
    3. For Let's Encrypt issues:
       - Verify domain points to your server
       - Check rate limits: https://letsencrypt.org/docs/rate-limits/
       - Try staging environment first
  </Accordion>
  
  <Accordion title="Database errors">
    **Symptoms:** "database locked", corruption warnings
    
    **Solutions:**
    1. Check database file permissions:
       ```bash
       ls -la /data/kombistack.db*
       ```
    
    2. For "database locked":
       ```bash
       # Check for stuck processes
       fuser /data/kombistack.db
       
       # If safe, restart Stack
       docker restart kombistack
       ```
    
    3. Restore from backup:
       ```bash
       # List backups
       ls /data/backups/
       
       # Restore
       cp /data/backups/kombistack-2026-02-01.db /data/kombistack.db
       ```
  </Accordion>
  
  <Accordion title="Drift detection shows unexpected changes">
    **Symptoms:** Drift alerts for unchanged resources
    
    **Solutions:**
    1. Check drift details:
       ```bash
       curl http://localhost:5260/api/v1/stacks/{stack-id}/drift
       ```
    
    2. Common causes:
       - Manual changes on nodes (not via Stack)
       - Container restarts changing IPs
       - Time-based values in configs
    
    3. Resolve drift:
       ```bash
       # Apply Stack state to nodes
       curl -X POST http://localhost:5260/api/v1/stacks/{stack-id}/drift/resolve
       
       # Or ignore specific drift
       curl -X POST http://localhost:5260/api/v1/stacks/{stack-id}/drift/ignore \
         -d '{"resources": ["traefik.config"]}'
       ```
  </Accordion>
  
  <Accordion title="Services not starting on nodes">
    **Symptoms:** Deployment succeeds but services unhealthy
    
    **Solutions:**
    1. Check service logs on node:
       ```bash
       ssh node-1 "docker logs traefik"
       ```
    
    2. Verify resources available:
       ```bash
       ssh node-1 "docker stats --no-stream"
       ssh node-1 "df -h"
       ```
    
    3. Check network connectivity:
       ```bash
       ssh node-1 "docker network ls"
       ssh node-1 "docker network inspect kombify"
       ```
    
    4. Verify port bindings:
       ```bash
       ssh node-1 "netstat -tlnp | grep -E '80|443'"
       ```
  </Accordion>
</AccordionGroup>

## Log analysis

### Enable debug logging

```bash
# Via environment variable
KOMBISTACK_LOG_LEVEL=debug docker run ...

# Or via API at runtime
curl -X PATCH http://localhost:5260/api/v1/settings \
  -d '{"log_level": "debug"}'
```

### Log locations

| Component | Location |
|-----------|----------|
| Stack API | `docker logs kombistack` or stdout |
| Agent | `/var/log/kombify-agent.log` or journald |
| OpenTofu | `/data/tofu/logs/` |
| PocketBase | Embedded in Stack logs |

### Log filtering

```bash
# Filter for errors only
docker logs kombistack 2>&1 | jq 'select(.level=="ERROR")'

# Filter by component
docker logs kombistack 2>&1 | jq 'select(.component=="unifier")'

# Filter by job ID
docker logs kombistack 2>&1 | jq 'select(.job_id=="job_abc123")'
```

## Diagnostic commands

### Get system info

```bash
curl http://localhost:5260/api/v1/info | jq
```

### Export debug bundle

Collect all diagnostic information:

```bash
curl -o debug-bundle.tar.gz \
  http://localhost:5260/api/v1/debug/bundle
```

This includes:
- Logs (last 24h)
- Configuration (sanitized)
- Worker status
- Recent job history
- System metrics

### Check connectivity matrix

```bash
curl http://localhost:5260/api/v1/workers/connectivity
```

## Recovery procedures

### Reset stuck job

```bash
# Cancel stuck job
curl -X POST http://localhost:5260/api/v1/jobs/{job-id}/cancel

# Force cleanup
curl -X POST http://localhost:5260/api/v1/jobs/{job-id}/cleanup
```

### Rebuild worker connection

```bash
# On Stack server
curl -X DELETE http://localhost:5260/api/v1/workers/{worker-id}

# On node - restart agent
systemctl restart kombify-agent
```

### Factory reset (caution!)

<Warning>
  This removes all data. Only use as last resort.
</Warning>

```bash
# Stop Stack
docker stop kombistack

# Backup data first
cp -r /data /data.backup.$(date +%Y%m%d)

# Remove database
rm /data/kombistack.db*

# Restart Stack
docker start kombistack
```

## Getting help

If you're still stuck:

1. **Search docs:** Use the search bar above
2. **Community Discord:** [discord.gg/kombify](https://discord.gg/kombify)
3. **GitHub Issues:** [github.com/kombify/stack/issues](https://github.com/kombify/stack/issues)

When reporting issues, include:
- Stack version (`curl http://localhost:5260/api/v1/info`)
- Error messages (full log output)
- Steps to reproduce
- Your `kombination.yaml` (sanitized)
