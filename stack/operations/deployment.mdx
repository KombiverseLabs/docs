---
title: Deployment operations
description: Deploy and manage your infrastructure with kombify Stack
sidebarTitle: Deployment
icon: rocket
---


Learn how to deploy, update, and manage your infrastructure using kombify Stack's deployment pipeline.

## Deployment workflow

```mermaid
flowchart LR
    Spec["kombination.yaml"] --> Validate["Validate"]
    Validate --> Generate["Generate IaC"]
    Generate --> Plan["Plan Changes"]
    Plan --> Apply["Apply"]
    Apply --> Monitor["Monitor"]
    
    style Spec fill:#1e293b,stroke:#38bdf8,color:#f8fafc
    style Validate fill:#1e293b,stroke:#fbbf24,color:#f8fafc
    style Generate fill:#1e293b,stroke:#4ade80,color:#f8fafc
    style Plan fill:#1e293b,stroke:#a78bfa,color:#f8fafc
    style Apply fill:#1e293b,stroke:#ec4899,color:#f8fafc
    style Monitor fill:#1e293b,stroke:#14b8a6,color:#f8fafc
```

## Deploy a new stack

<Steps>
  <Step title="Create your spec file">
    Create or update your `kombination.yaml`:
    
    ```yaml kombination.yaml
    stackkit: base-homelab
    
    nodes:
      - name: main-server
        type: local
        connection:
          host: 192.168.1.100
          user: root
    
    services:
      traefik:
        enabled: true
      dokploy:
        enabled: true
    ```
  </Step>
  
  <Step title="Validate configuration">
    Validate your spec before deployment:
    
    ```bash
    curl -X POST http://localhost:5260/api/v1/unifier/validate \
      -H "Content-Type: application/yaml" \
      --data-binary @kombination.yaml
    ```
    
    Or via the web UI: **Stack â†’ Validate**
  </Step>
  
  <Step title="Generate infrastructure code">
    Generate OpenTofu and Docker configurations:
    
    ```bash
    curl -X POST http://localhost:5260/api/v1/unifier/generate \
      -H "Content-Type: application/yaml" \
      --data-binary @kombination.yaml
    ```
  </Step>
  
  <Step title="Preview changes">
    See what will be created before applying:
    
    ```bash
    curl -X POST http://localhost:5260/api/v1/unifier/preview \
      -H "Content-Type: application/yaml" \
      --data-binary @kombination.yaml
    ```
  </Step>
  
  <Step title="Apply deployment">
    Deploy to your infrastructure:
    
    ```bash
    curl -X POST http://localhost:5260/api/v1/stacks/{stack-id}/provision
    ```
    
    This triggers the full deployment pipeline:
    1. Run pre-checks on target nodes
    2. Apply OpenTofu configuration
    3. Deploy Docker services
    4. Verify health checks
  </Step>
</Steps>

## Deployment states

| State | Description |
|-------|-------------|
| `pending` | Deployment queued |
| `validating` | Validating spec |
| `generating` | Generating IaC |
| `planning` | Running tofu plan |
| `applying` | Applying changes |
| `deploying` | Deploying services |
| `verifying` | Running health checks |
| `completed` | Successfully deployed |
| `failed` | Deployment failed |
| `rolled_back` | Rolled back to previous state |

## Update an existing stack

<Tabs>
  <Tab title="Rolling update">
    Apply changes without downtime:
    
    ```bash
    curl -X POST http://localhost:5260/api/v1/stacks/{stack-id}/deploy \
      -H "Content-Type: application/json" \
      -d '{"strategy": "rolling"}'
    ```
  </Tab>
  <Tab title="Recreate">
    Stop all services, then redeploy:
    
    ```bash
    curl -X POST http://localhost:5260/api/v1/stacks/{stack-id}/deploy \
      -H "Content-Type: application/json" \
      -d '{"strategy": "recreate"}'
    ```
  </Tab>
</Tabs>

## Destroy a stack

<Warning>
  This will permanently destroy all resources. Make sure to backup any data first.
</Warning>

```bash
curl -X POST http://localhost:5260/api/v1/stacks/{stack-id}/destroy
```

## Deployment jobs

All deployments run as background jobs. Check job status:

```bash
# List recent jobs
curl http://localhost:5260/api/v1/jobs

# Get specific job status
curl http://localhost:5260/api/v1/jobs/{job-id}
```

### Job status response

```json
{
  "id": "job_abc123",
  "type": "provision",
  "status": "running",
  "progress": 65,
  "started_at": "2026-02-03T10:00:00Z",
  "steps": [
    {"name": "validate", "status": "completed"},
    {"name": "generate", "status": "completed"},
    {"name": "apply", "status": "running"},
    {"name": "verify", "status": "pending"}
  ]
}
```

## Pre-deployment checks

Stack runs pre-checks before deployment to ensure nodes are ready:

| Check | Description |
|-------|-------------|
| **Connectivity** | SSH/agent connection working |
| **OS compatibility** | Supported distribution and version |
| **Resources** | Sufficient CPU, RAM, disk |
| **Docker** | Docker installed and running |
| **Ports** | Required ports available |

```bash
# Run pre-checks manually
curl -X POST http://localhost:5260/api/v1/workers/{worker-id}/prechecks
```

## Rollback

If a deployment fails, Stack can rollback to the previous state:

```bash
# Automatic rollback (enabled by default)
curl -X POST http://localhost:5260/api/v1/stacks/{stack-id}/deploy \
  -d '{"auto_rollback": true}'

# Manual rollback
curl -X POST http://localhost:5260/api/v1/stacks/{stack-id}/rollback
```

## Next steps

<CardGroup cols={2}>
  <Card title="Monitoring" icon="chart-line" href="/stack/operations/monitoring">
    Monitor your deployed infrastructure
  </Card>
  <Card title="Drift detection" icon="arrows-rotate" href="/stack/troubleshooting">
    Detect and fix configuration drift
  </Card>
</CardGroup>
