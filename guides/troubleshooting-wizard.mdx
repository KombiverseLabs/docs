---
title: "Troubleshooting wizard"
description: "Interactive troubleshooting guide to diagnose and fix common kombify issues"
sidebarTitle: "Troubleshooting wizard"
icon: "wand-magic-sparkles"
---

# Troubleshooting Wizard

Use this interactive wizard to diagnose and resolve common issues with kombify.

<Note>
  Select the symptom that best describes your issue to get step-by-step resolution guidance.
</Note>

## What are you experiencing?

<CardGroup cols={2}>
  <Card title="Installation issues" icon="download" href="#installation-issues">
    Problems during initial setup or installation
  </Card>
  <Card title="Connection problems" icon="plug" href="#connection-problems">
    Agents not connecting, network issues
  </Card>
  <Card title="Deployment failures" icon="triangle-exclamation" href="#deployment-failures">
    Configuration validation or apply errors
  </Card>
  <Card title="Service issues" icon="server" href="#service-issues">
    Services not running or not accessible
  </Card>
  <Card title="Performance problems" icon="gauge-high" href="#performance-problems">
    Slow operations, high resource usage
  </Card>
  <Card title="Simulation issues" icon="flask" href="#simulation-issues">
    Problems with kombify Sim
  </Card>
</CardGroup>

---

## Installation Issues

<AccordionGroup>
  <Accordion title="Docker Compose fails to start">
    ### Symptoms
    - `docker compose up` fails with errors
    - Services exit immediately after starting
    - Port binding errors
    
    ### Diagnosis
    
    <Steps>
      <Step title="Check Docker is running">
        ```bash
        docker info
        ```
        **If error:** Start Docker daemon or Docker Desktop
      </Step>
      
      <Step title="Check port availability">
        ```bash
        # Linux/macOS
        netstat -tuln | grep -E '5260|5263|5270'
        
        # Windows
        netstat -an | findstr "5260 5263 5270"
        ```
        **If ports in use:** Stop conflicting services or change ports in `.env`
      </Step>
      
      <Step title="Check disk space">
        ```bash
        df -h
        ```
        **Need:** At least 5GB free space
      </Step>
      
      <Step title="View detailed logs">
        ```bash
        docker compose logs --tail=50
        ```
      </Step>
    </Steps>
    
    ### Common Fixes
    
    <Tabs>
      <Tab title="Port Conflict">
        Edit `.env` or `docker-compose.yml`:
        ```yaml
        environment:
          - KOMBISTACK_PORT=5261  # Use different port
        ```
      </Tab>
      <Tab title="Permission Error">
        ```bash
        # Fix Docker socket permissions
        sudo chmod 666 /var/run/docker.sock
        
        # Or add user to docker group
        sudo usermod -aG docker $USER
        ```
      </Tab>
      <Tab title="Resource Limits">
        Increase Docker resources in Docker Desktop settings:
        - Memory: 4GB minimum
        - CPU: 2 cores minimum
      </Tab>
    </Tabs>
  </Accordion>
  
  <Accordion title="Binary installation fails">
    ### Symptoms
    - Install script fails
    - Binary not found after install
    - Architecture mismatch errors
    
    ### Diagnosis
    
    <Steps>
      <Step title="Check system architecture">
        ```bash
        uname -m
        ```
        **Expected:** `x86_64` (amd64) or `aarch64` (arm64)
      </Step>
      
      <Step title="Check Go version (if building)">
        ```bash
        go version
        ```
        **Required:** Go 1.22+
      </Step>
      
      <Step title="Verify PATH">
        ```bash
        echo $PATH
        which kombify
        ```
      </Step>
    </Steps>
    
    ### Manual Installation
    ```bash
    # Download correct binary
    ARCH=$(uname -m)
    case $ARCH in
      x86_64) ARCH="amd64" ;;
      aarch64) ARCH="arm64" ;;
    esac
    
    curl -L "https://github.com/kombify/kombifyStack/releases/latest/download/kombistack-linux-${ARCH}" -o /usr/local/bin/kombify
    chmod +x /usr/local/bin/kombify
    ```
  </Accordion>
</AccordionGroup>

---

## Connection Problems

<AccordionGroup>
  <Accordion title="Agent shows 'disconnected' status">
    ### Symptoms
    - Agent appears in dashboard but shows disconnected
    - Heartbeat failures in logs
    - Intermittent connectivity
    
    ### Decision Tree
    
    ```mermaid
    flowchart TD
        A[Agent Disconnected] --> B{Can ping Stack host?}
        B -->|No| C[Network/DNS Issue]
        B -->|Yes| D{Port 5263 open?}
        D -->|No| E[Firewall Issue]
        D -->|Yes| F{Certificate valid?}
        F -->|No| G[Regenerate Certs]
        F -->|Yes| H{Time synced?}
        H -->|No| I[Fix NTP]
        H -->|Yes| J[Check Logs]
    ```
    
    ### Step-by-Step Fix
    
    <Steps>
      <Step title="Test network connectivity">
        ```bash
        # From agent node
        ping your-stack-host
        nc -zv your-stack-host 5263
        ```
      </Step>
      
      <Step title="Check certificate validity">
        ```bash
        openssl x509 -in /etc/kombify/agent.crt -text -noout | grep -A2 "Validity"
        ```
        **If expired:** Regenerate with `make certs-agent AGENT=name`
      </Step>
      
      <Step title="Verify time synchronization">
        ```bash
        timedatectl status
        # Should show: NTP synchronized: yes
        ```
        **If not synced:**
        ```bash
        sudo systemctl enable --now systemd-timesyncd
        ```
      </Step>
      
      <Step title="Check agent logs">
        ```bash
        journalctl -u kombify-agent -f
        ```
        Look for specific error messages.
      </Step>
    </Steps>
  </Accordion>
  
  <Accordion title="gRPC connection refused">
    ### Symptoms
    - `connection refused` errors
    - Agent can't register
    - TLS handshake failures
    
    ### Fixes by Error Type
    
    <Tabs>
      <Tab title="Connection Refused">
        Stack gRPC server not running or wrong port:
        ```bash
        # Check Stack is running
        docker ps | grep stack
        
        # Check port binding
        docker port kombify-stack 5263
        ```
      </Tab>
      
      <Tab title="TLS Handshake Failed">
        Certificate mismatch:
        ```bash
        # On Stack
        make certs-init
        
        # On Agent
        make certs-agent AGENT=my-node
        
        # Copy new certs to agent
        scp data/certs/agent-my-node.* user@agent-host:/etc/kombify/
        ```
      </Tab>
      
      <Tab title="Certificate Expired">
        Regenerate CA and all agent certs:
        ```bash
        make certs-rotate-ca
        make certs-agent AGENT=node1
        make certs-agent AGENT=node2
        # Redeploy certs to all nodes
        ```
      </Tab>
    </Tabs>
  </Accordion>
</AccordionGroup>

---

## Deployment Failures

<AccordionGroup>
  <Accordion title="Validation errors">
    ### Common Validation Errors
    
    <Tabs>
      <Tab title="Unknown Field">
        **Error:** `field "xyz" not allowed`
        
        **Cause:** Typo or invalid field name
        
        **Fix:** Check StackKit schema for valid fields:
        ```bash
        kombify schema show base-homelab
        ```
      </Tab>
      
      <Tab title="Missing Required Field">
        **Error:** `field "domain" is required`
        
        **Fix:** Add the required field:
        ```yaml
        config:
          domain: home.example.com  # Add this
        ```
      </Tab>
      
      <Tab title="Type Mismatch">
        **Error:** `expected string, got number`
        
        **Fix:** Ensure correct types:
        ```yaml
        # Wrong
        port: "8080"
        
        # Correct
        port: 8080
        ```
      </Tab>
      
      <Tab title="Invalid Service">
        **Error:** `service "xyz" not found in StackKit`
        
        **Fix:** Check available services:
        ```bash
        kombify services list --stackkit base-homelab
        ```
      </Tab>
    </Tabs>
  </Accordion>
  
  <Accordion title="OpenTofu/Apply errors">
    ### Symptoms
    - Plan succeeds but apply fails
    - Resource creation errors
    - Provider errors
    
    ### Common Fixes
    
    <Steps>
      <Step title="Check provider credentials">
        For cloud providers, verify credentials:
        ```bash
        # AWS
        aws sts get-caller-identity
        
        # Azure
        az account show
        ```
      </Step>
      
      <Step title="Check resource limits">
        Verify you haven't hit quota limits in cloud console.
      </Step>
      
      <Step title="Retry with state refresh">
        ```bash
        kombify deploy --refresh
        ```
      </Step>
      
      <Step title="Manual state fix (advanced)">
        ```bash
        cd data/tofu
        tofu state list
        tofu state rm problematic.resource
        ```
      </Step>
    </Steps>
  </Accordion>
</AccordionGroup>

---

## Service Issues

<AccordionGroup>
  <Accordion title="Service not starting">
    ### Quick Checks
    
    ```bash
    # Check container status
    docker ps -a | grep service-name
    
    # View logs
    docker logs service-name --tail=100
    
    # Check resource usage
    docker stats --no-stream
    ```
    
    ### Common Causes
    
    | Symptom | Likely Cause | Fix |
    |---------|--------------|-----|
    | Exits immediately | Config error | Check logs for specific error |
    | OOMKilled | Memory limit | Increase container memory |
    | Pending | Volume issue | Check volume mounts exist |
    | CrashLoopBackOff | Dependencies | Ensure required services running |
  </Accordion>
  
  <Accordion title="Service not accessible">
    ### Diagnosis Flow
    
    <Steps>
      <Step title="Verify service is running">
        ```bash
        docker ps | grep service-name
        curl localhost:internal-port/health
        ```
      </Step>
      
      <Step title="Check Traefik routing">
        Access Traefik dashboard: `http://your-host:8080/dashboard/`
        
        Verify:
        - Router exists for your service
        - No errors on router
        - Correct entrypoint (web/websecure)
      </Step>
      
      <Step title="Test DNS resolution">
        ```bash
        nslookup service.yourdomain.com
        # Or check /etc/hosts for local domains
        ```
      </Step>
      
      <Step title="Check SSL certificate">
        ```bash
        openssl s_client -connect service.yourdomain.com:443 -servername service.yourdomain.com
        ```
      </Step>
    </Steps>
  </Accordion>
</AccordionGroup>

---

## Performance Problems

<AccordionGroup>
  <Accordion title="High CPU or memory usage">
    ### Identification
    
    ```bash
    # Container resource usage
    docker stats
    
    # System overview
    htop
    ```
    
    ### Mitigation
    
    <Tabs>
      <Tab title="Set Resource Limits">
        In `kombination.yaml`:
        ```yaml
        services:
          my-service:
            resources:
              memory: 512M
              cpu: 0.5
        ```
      </Tab>
      <Tab title="Scale Horizontally">
        Add more nodes and distribute services.
      </Tab>
      <Tab title="Optimize Service">
        Check service-specific tuning guides in our docs.
      </Tab>
    </Tabs>
  </Accordion>
</AccordionGroup>

---

## Simulation Issues

<AccordionGroup>
  <Accordion title="Sim nodes fail to start">
    ### Docker Backend
    
    ```bash
    # Check Docker daemon
    docker info
    
    # Check Sim logs
    docker logs kombify-sim
    
    # Verify Sim can access Docker socket
    docker exec kombify-sim docker ps
    ```
    
    ### QEMU Backend
    
    ```bash
    # Check KVM support
    lsmod | grep kvm
    
    # Verify QEMU installed
    qemu-system-x86_64 --version
    
    # Check permissions
    ls -la /dev/kvm
    ```
  </Accordion>
</AccordionGroup>

---

## Still Stuck?

If you've tried the above steps without success:

<CardGroup cols={2}>
  <Card title="Collect Debug Info" icon="bug">
    Run:
    ```bash
    kombify debug-bundle
    ```
    This creates a zip file with logs and system info.
  </Card>
  <Card title="Get Help" icon="life-ring" href="https://discord.gg/kombify">
    Share the debug bundle in our Discord #support channel.
  </Card>
</CardGroup>
