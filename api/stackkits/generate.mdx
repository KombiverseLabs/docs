---
title: Generate endpoint
description: Generate infrastructure code from StackKit configurations
---

# Generate infrastructure code

Generates deployment artifacts (Docker Compose, Kubernetes manifests, etc.) from a validated StackKit configuration.

## Endpoint

```
POST /api/v1/stackkits/generate
```

## Request

### Headers

| Header | Required | Description |
|--------|----------|-------------|
| `Content-Type` | Yes | Must be `application/json` |
| `Authorization` | No | Required for Sphere API |

### Body

<ParamField path="stackkit" type="string" required>
  The StackKit ID to generate from (e.g., `base-homelab`)
</ParamField>

<ParamField path="version" type="string">
  Specific version to use. Defaults to latest.
</ParamField>

<ParamField path="config" type="object" required>
  The configuration object (should be pre-validated)
</ParamField>

<ParamField path="output" type="string" required>
  Output target format. See available targets below.
</ParamField>

<ParamField path="options" type="object">
  Output-specific options
</ParamField>

### Available output targets

| Target | Description |
|--------|-------------|
| `docker-compose` | Docker Compose v3.8 YAML |
| `kubernetes` | Kubernetes manifests (Deployment, Service, ConfigMap) |
| `opentofu` | OpenTofu/Terraform HCL modules |
| `ansible` | Ansible playbooks and roles |
| `shell` | Shell scripts for manual deployment |

### Example request

```bash
curl -X POST http://localhost:8080/api/v1/stackkits/generate \
  -H "Content-Type: application/json" \
  -d '{
    "stackkit": "base-homelab",
    "version": "1.2.0",
    "config": {
      "domain": "home.example.com",
      "services": ["traefik", "portainer", "homepage"]
    },
    "output": "docker-compose",
    "options": {
      "include_env_example": true,
      "include_readme": true
    }
  }'
```

## Response

### Success

```json
{
  "stackkit": "base-homelab",
  "version": "1.2.0",
  "output": "docker-compose",
  "generated_at": "2026-01-26T10:00:00Z",
  "files": [
    {
      "path": "docker-compose.yml",
      "content": "version: '3.8'\n\nservices:\n  traefik:\n    image: traefik:v3.0\n    container_name: traefik\n    restart: unless-stopped\n    ports:\n      - '80:80'\n      - '443:443'\n    volumes:\n      - /var/run/docker.sock:/var/run/docker.sock:ro\n      - ./traefik:/etc/traefik\n    networks:\n      - homelab\n\n  portainer:\n    image: portainer/portainer-ce:latest\n    container_name: portainer\n    restart: unless-stopped\n    volumes:\n      - /var/run/docker.sock:/var/run/docker.sock\n      - portainer_data:/data\n    labels:\n      - 'traefik.enable=true'\n      - 'traefik.http.routers.portainer.rule=Host(`portainer.home.example.com`)'\n    networks:\n      - homelab\n\n  homepage:\n    image: ghcr.io/gethomepage/homepage:latest\n    container_name: homepage\n    restart: unless-stopped\n    volumes:\n      - ./homepage:/app/config\n    labels:\n      - 'traefik.enable=true'\n      - 'traefik.http.routers.homepage.rule=Host(`home.example.com`)'\n    networks:\n      - homelab\n\nnetworks:\n  homelab:\n    driver: bridge\n\nvolumes:\n  portainer_data:\n"
    },
    {
      "path": ".env.example",
      "content": "# Domain configuration\nDOMAIN=home.example.com\nACME_EMAIL=admin@example.com\n\n# Timezone\nTZ=UTC\n\n# Portainer admin password (change this!)\nPORTAINER_ADMIN_PASSWORD=changeme\n"
    },
    {
      "path": "README.md",
      "content": "# Base Homelab Stack\n\nGenerated by kombify StackKits.\n\n## Quick Start\n\n1. Copy `.env.example` to `.env` and configure\n2. Run `docker compose up -d`\n3. Access your services at:\n   - Homepage: https://home.example.com\n   - Portainer: https://portainer.home.example.com\n"
    }
  ],
  "checksums": {
    "docker-compose.yml": "sha256:abc123...",
    ".env.example": "sha256:def456..."
  }
}
```

## Output options

### Docker Compose options

| Option | Type | Default | Description |
|--------|------|---------|-------------|
| `include_env_example` | bool | true | Generate `.env.example` file |
| `include_readme` | bool | false | Generate README.md |
| `compose_version` | string | "3.8" | Compose file version |
| `use_profiles` | bool | false | Use Docker Compose profiles |

### Kubernetes options

| Option | Type | Default | Description |
|--------|------|---------|-------------|
| `namespace` | string | "default" | Target namespace |
| `include_namespace` | bool | false | Generate Namespace manifest |
| `include_ingress` | bool | true | Generate Ingress resources |
| `ingress_class` | string | "nginx" | Ingress controller class |
| `storage_class` | string | "default" | StorageClass for PVCs |

### OpenTofu options

| Option | Type | Default | Description |
|--------|------|---------|-------------|
| `provider` | string | "docker" | Target provider |
| `state_backend` | string | "local" | State backend type |
| `include_variables` | bool | true | Generate variables.tf |

## Error responses

| Code | HTTP Status | Description |
|------|-------------|-------------|
| `STACKKIT_NOT_FOUND` | 404 | StackKit doesn't exist |
| `UNSUPPORTED_TARGET` | 400 | Output target not supported |
| `INVALID_CONFIG` | 400 | Config validation failed |
| `GENERATION_ERROR` | 500 | Internal generation error |

### Example error

```json
{
  "error": {
    "code": "UNSUPPORTED_TARGET",
    "message": "Output target 'pulumi' is not supported",
    "supported": ["docker-compose", "kubernetes", "opentofu", "ansible", "shell"]
  }
}
```

## Common patterns

<Accordion title="Generate and write files" icon="file">

```bash
#!/bin/bash
OUTPUT_DIR="./generated"

# Generate
RESPONSE=$(curl -s -X POST http://localhost:8080/api/v1/stackkits/generate \
  -H "Content-Type: application/json" \
  -d @kombination.yaml)

# Create output directory
mkdir -p "$OUTPUT_DIR"

# Write each file
echo "$RESPONSE" | jq -c '.files[]' | while read -r file; do
  FILE_PATH="$OUTPUT_DIR/$(echo $file | jq -r .path)"
  FILE_CONTENT=$(echo $file | jq -r .content)
  
  # Create subdirectories if needed
  mkdir -p "$(dirname "$FILE_PATH")"
  
  # Write file
  echo "$FILE_CONTENT" > "$FILE_PATH"
  echo "Created: $FILE_PATH"
done

echo "âœ… Generated $(echo $RESPONSE | jq '.files | length') files"
```

</Accordion>

<Accordion title="Generate for multiple targets" icon="layers">

```bash
#!/bin/bash
TARGETS=("docker-compose" "kubernetes")
CONFIG_FILE="kombination.yaml"

for target in "${TARGETS[@]}"; do
  echo "Generating $target..."
  
  curl -s -X POST http://localhost:8080/api/v1/stackkits/generate \
    -H "Content-Type: application/json" \
    -d "{
      \"stackkit\": \"base-homelab\",
      \"config\": $(cat $CONFIG_FILE),
      \"output\": \"$target\"
    }" | jq -c '.files[]' | while read -r file; do
      mkdir -p "output/$target"
      echo "$file" | jq -r '.content' > "output/$target/$(echo $file | jq -r '.path')"
    done
done
```

</Accordion>

<Accordion title="Diff before applying" icon="code-compare">

```bash
#!/bin/bash

# Generate new config
NEW_COMPOSE=$(curl -s -X POST http://localhost:8080/api/v1/stackkits/generate \
  -H "Content-Type: application/json" \
  -d @kombination.yaml | jq -r '.files[] | select(.path == "docker-compose.yml") | .content')

# Compare with current
echo "$NEW_COMPOSE" > /tmp/new-compose.yml
diff --color docker-compose.yml /tmp/new-compose.yml

# If different, ask for confirmation
if [ $? -ne 0 ]; then
  read -p "Apply changes? [y/N] " confirm
  if [ "$confirm" = "y" ]; then
    echo "$NEW_COMPOSE" > docker-compose.yml
    docker compose up -d
  fi
fi
```

</Accordion>

## Related

<CardGroup cols={2}>
  <Card title="Validate endpoint" icon="check" href="/api/stackkits/validate">
    Validate configurations first
  </Card>
  <Card title="StackKits overview" icon="boxes-stacked" href="/api/stackkits/overview">
    StackKits API overview
  </Card>
</CardGroup>
