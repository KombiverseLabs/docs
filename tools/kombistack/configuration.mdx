---
title: KombiStack configuration
description: Complete configuration reference for all deployment scenarios
---

# Configuration

Configure KombiStack for your specific deployment needs using environment variables, configuration files, or the admin UI.

## Configuration methods

<CardGroup cols={3}>
  <Card title="Environment variables" icon="terminal">
    Best for Docker deployments
  </Card>
  <Card title="Config file" icon="file-code">
    Best for binary deployments
  </Card>
  <Card title="Admin UI" icon="browser">
    Best for runtime changes
  </Card>
</CardGroup>

## Environment variables

### Core configuration

```env
# Server Configuration
API_PORT=5260
GRPC_PORT=5263
HOST=0.0.0.0

# PocketBase Configuration
POCKETBASE_DATA_DIR=/app/pb_data
POCKETBASE_ADMIN_EMAIL=admin@kombistack.local
POCKETBASE_ADMIN_PASSWORD=changeme

# Logging
LOG_LEVEL=info  # debug, info, warn, error
LOG_FORMAT=json # json, text

# Development
KOMBISTACK_DEBUG=false
```

### Frontend configuration

```env
# API Connection
KOMBISTACK_API_URL=http://localhost:5260
PUBLIC_API_URL=http://localhost:5260

# Application
PUBLIC_APP_NAME=KombiStack
PUBLIC_APP_URL=http://localhost:5261

# Features
ENABLE_EASY_WIZARD=true
ENABLE_EXPERT_WIZARD=true
ENABLE_SIMULATION=true
```

### OpenTofu configuration

```env
# OpenTofu Binary
TOFU_BINARY_PATH=/usr/local/bin/tofu
TOFU_VERSION=1.6.0

# Execution
TOFU_PARALLELISM=10
TOFU_TIMEOUT=3600  # seconds

# State Management
TOFU_STATE_DIR=/app/pb_data/stacks
TOFU_BACKUP_ENABLED=true
```

### Agent configuration

```env
# gRPC Server
GRPC_ENABLE_TLS=true
GRPC_CERT_PATH=/app/pb_data/certs/server.crt
GRPC_KEY_PATH=/app/pb_data/certs/server.key

# Agent Settings
AGENT_HEARTBEAT_INTERVAL=30s
AGENT_TIMEOUT=300s
AGENT_MAX_RETRIES=3
```

### VPN configuration

```env
# Headscale
HEADSCALE_ENABLED=true
HEADSCALE_URL=http://headscale:8080
HEADSCALE_API_KEY=your-api-key

# Network
VPN_NETWORK=100.64.0.0/10
VPN_DNS_SERVERS=1.1.1.1,8.8.8.8
```

### Simulation configuration

```env
# KombiSim Integration
KOMBISIM_ENABLED=true
KOMBISIM_URL=http://localhost:5270
KOMBISIM_AUTO_VALIDATE=true
KOMBISIM_TIMEOUT=300s
```

## Configuration file

For binary deployments, use `kombistack.yaml`:

```yaml
# kombistack.yaml
server:
  api_port: 5260
  grpc_port: 5263
  host: 0.0.0.0

pocketbase:
  data_dir: ./pb_data
  admin:
    email: admin@kombistack.local
    password: changeme

logging:
  level: info
  format: json
  file: /var/log/kombistack/app.log

opentofu:
  binary_path: /usr/local/bin/tofu
  parallelism: 10
  timeout: 3600
  state_dir: ./pb_data/stacks

grpc:
  enable_tls: true
  cert_path: ./certs/server.crt
  key_path: ./certs/server.key

agents:
  heartbeat_interval: 30s
  timeout: 300s
  max_retries: 3

headscale:
  enabled: true
  url: http://localhost:8080
  api_key: ${HEADSCALE_API_KEY}
  network: 100.64.0.0/10

kombisim:
  enabled: true
  url: http://localhost:5270
  auto_validate: true
  timeout: 300s
```

**Load configuration:**

```bash
# Specify config file
kombistack serve --config kombistack.yaml

# Or use default location
# ~/.config/kombistack/config.yaml
kombistack serve
```

## Admin UI configuration

Access the PocketBase admin UI at `http://localhost:5260/_/`

### Collections configuration

<Tabs>
  <Tab title="Users">
    **Fields:**
    - `email` - User email (unique)
    - `password` - Hashed password
    - `role` - admin, user
    - `verified` - Email verification status
    
    **Rules:**
    ```javascript
    // List rule
    @request.auth.id != ""
    
    // View rule
    @request.auth.id = id || @request.auth.role = "admin"
    
    // Create rule
    @request.auth.role = "admin"
    ```
  </Tab>

  <Tab title="Stacks">
    **Fields:**
    - `name` - Stack name
    - `kit` - StackKit identifier
    - `spec` - kombination.yaml content
    - `status` - pending, running, completed, failed
    - `owner` - User ID
    
    **Rules:**
    ```javascript
    // List rule
    @request.auth.id != "" && owner = @request.auth.id
    
    // Create rule
    @request.auth.id != ""
    ```
  </Tab>

  <Tab title="Workers">
    **Fields:**
    - `name` - Worker/node name
    - `stack` - Stack ID
    - `ip` - IP address
    - `status` - online, offline, error
    - `last_seen` - Last heartbeat timestamp
    
    **Rules:**
    ```javascript
    // List rule
    @request.auth.id != ""
    
    // Update rule (agents only)
    @request.auth.type = "agent"
    ```
  </Tab>

  <Tab title="Jobs">
    **Fields:**
    - `stack` - Stack ID
    - `type` - deploy, destroy, update
    - `status` - queued, running, completed, failed
    - `logs` - Execution logs
    - `started_at` - Start timestamp
    - `completed_at` - Completion timestamp
    
    **Rules:**
    ```javascript
    // List rule
    @request.auth.id != ""
    
    // View rule
    @request.auth.id != ""
    ```
  </Tab>
</Tabs>

## Advanced configuration

### Custom StackKit paths

```yaml
stackkits:
  paths:
    - /app/stackkits
    - /custom/stackkits
  
  repositories:
    - url: https://github.com/KombiverseLabs/StackKits
      branch: main
    - url: https://github.com/myorg/custom-stackkits
      branch: main
```

### SSH wallet configuration

```yaml
ssh:
  wallet_dir: /app/pb_data/wallet
  key_type: ed25519  # rsa, ecdsa, ed25519
  key_size: 4096     # for RSA only
  
  # Auto-generate on first run
  auto_generate: true
  
  # Passphrase protection
  passphrase_enabled: false
  passphrase: ${SSH_PASSPHRASE}
```

### Job queue configuration

```yaml
jobs:
  # Concurrent job execution
  max_concurrent: 5
  
  # Job retention
  retention_days: 30
  
  # Retry policy
  retry:
    max_attempts: 3
    backoff: exponential
    initial_delay: 5s
    max_delay: 300s
```

### Monitoring configuration

```yaml
monitoring:
  # Prometheus metrics
  metrics:
    enabled: true
    port: 9090
    path: /metrics
  
  # Health checks
  health:
    enabled: true
    interval: 30s
    timeout: 5s
  
  # Audit logging
  audit:
    enabled: true
    log_file: /var/log/kombistack/audit.log
    retention_days: 90
```

### Backup configuration

```yaml
backup:
  # Automatic backups
  enabled: true
  interval: 24h
  retention: 7
  
  # Backup location
  path: /app/pb_data/backups
  
  # S3 backup (optional)
  s3:
    enabled: false
    bucket: kombistack-backups
    region: us-east-1
    access_key: ${AWS_ACCESS_KEY}
    secret_key: ${AWS_SECRET_KEY}
```

## Docker Compose configuration

Complete `docker-compose.yml` example:

```yaml
version: '3.8'

services:
  kombistack:
    image: ghcr.io/kombiverselabs/kombistack:latest
    container_name: kombistack
    ports:
      - "5260:5260"
      - "5263:5263"
    environment:
      # Core
      - API_PORT=5260
      - GRPC_PORT=5263
      - LOG_LEVEL=info
      
      # PocketBase
      - POCKETBASE_ADMIN_EMAIL=${ADMIN_EMAIL}
      - POCKETBASE_ADMIN_PASSWORD=${ADMIN_PASSWORD}
      
      # OpenTofu
      - TOFU_PARALLELISM=10
      
      # Headscale
      - HEADSCALE_ENABLED=true
      - HEADSCALE_URL=http://headscale:8080
      - HEADSCALE_API_KEY=${HEADSCALE_API_KEY}
    volumes:
      - kombistack-data:/app/pb_data
      - /var/run/docker.sock:/var/run/docker.sock
    networks:
      - kombistack-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5260/api/v1/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  app:
    image: ghcr.io/kombiverselabs/kombistack-ui:latest
    container_name: kombistack-ui
    ports:
      - "5261:5261"
    environment:
      - KOMBISTACK_API_URL=http://kombistack:5260
      - PUBLIC_APP_URL=http://localhost:5261
    depends_on:
      - kombistack
    networks:
      - kombistack-network
    restart: unless-stopped

  headscale:
    image: headscale/headscale:latest
    container_name: headscale
    ports:
      - "8080:8080"
      - "9090:9090"
    environment:
      - HEADSCALE_SERVER_URL=http://localhost:8080
    volumes:
      - headscale-data:/etc/headscale
    networks:
      - kombistack-network
    restart: unless-stopped

volumes:
  kombistack-data:
  headscale-data:

networks:
  kombistack-network:
    driver: bridge
```

## Production configuration

### Reverse proxy (Traefik)

```yaml
# docker-compose.prod.yml
services:
  traefik:
    image: traefik:3.0
    ports:
      - "80:80"
      - "443:443"
    command:
      - --api.dashboard=true
      - --providers.docker=true
      - --entrypoints.web.address=:80
      - --entrypoints.websecure.address=:443
      - --certificatesresolvers.letsencrypt.acme.email=admin@example.com
      - --certificatesresolvers.letsencrypt.acme.storage=/letsencrypt/acme.json
      - --certificatesresolvers.letsencrypt.acme.httpchallenge.entrypoint=web
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - traefik-certs:/letsencrypt
    networks:
      - kombistack-network

  kombistack:
    labels:
      - traefik.enable=true
      - traefik.http.routers.kombistack.rule=Host(`api.kombistack.example.com`)
      - traefik.http.routers.kombistack.entrypoints=websecure
      - traefik.http.routers.kombistack.tls.certresolver=letsencrypt
      - traefik.http.services.kombistack.loadbalancer.server.port=5260

  app:
    labels:
      - traefik.enable=true
      - traefik.http.routers.app.rule=Host(`kombistack.example.com`)
      - traefik.http.routers.app.entrypoints=websecure
      - traefik.http.routers.app.tls.certresolver=letsencrypt
      - traefik.http.services.app.loadbalancer.server.port=5261
```

### TLS configuration

```yaml
grpc:
  enable_tls: true
  cert_path: /app/certs/server.crt
  key_path: /app/certs/server.key
  ca_path: /app/certs/ca.crt
  
  # Client certificate verification
  client_auth: require
  
  # TLS version
  min_version: "1.3"
  
  # Cipher suites
  cipher_suites:
    - TLS_AES_128_GCM_SHA256
    - TLS_AES_256_GCM_SHA384
    - TLS_CHACHA20_POLY1305_SHA256
```

### Rate limiting

```yaml
rate_limiting:
  enabled: true
  
  # Global limits
  global:
    requests_per_minute: 300
    requests_per_hour: 5000
  
  # Per-endpoint limits
  endpoints:
    - path: /api/v1/stacks
      method: POST
      requests_per_minute: 10
    
    - path: /api/v1/unifier/*
      method: POST
      requests_per_minute: 60
```

## Troubleshooting configuration

### Debug mode

```bash
# Enable debug logging
export KOMBISTACK_DEBUG=true
export LOG_LEVEL=debug

# Start with verbose output
kombistack serve --debug --verbose
```

### Configuration validation

```bash
# Validate configuration file
kombistack config validate kombistack.yaml

# Show effective configuration
kombistack config show

# Test database connection
kombistack config test-db
```

### Common issues

<AccordionGroup>
  <Accordion title="Port conflicts">
    **Symptoms:** "address already in use"
    
    **Solutions:**
    ```yaml
    # Change ports in docker-compose.yml
    ports:
      - "5360:5260"  # Use different host port
      - "5363:5263"
    ```
  </Accordion>

  <Accordion title="Permission errors">
    **Symptoms:** "permission denied" accessing volumes
    
    **Solutions:**
    ```bash
    # Fix volume permissions
    sudo chown -R 1000:1000 ./pb_data
    
    # Or run as specific user
    docker compose run --user 1000:1000 kombistack
    ```
  </Accordion>

  <Accordion title="Database locked">
    **Symptoms:** "database is locked"
    
    **Solutions:**
    ```yaml
    # Enable WAL mode (default)
    pocketbase:
      wal_mode: true
      
    # Increase timeout
    database:
      busy_timeout: 5000  # milliseconds
    ```
  </Accordion>
</AccordionGroup>

## Next steps

<CardGroup cols={2}>
  <Card
    title="API reference"
    icon="code"
    href="/api/kombistack/overview"
  >
    Explore the REST API
  </Card>
  <Card
    title="Production checklist"
    icon="clipboard-check"
    href="/guides/deployment/production-checklist"
  >
    Prepare for production
  </Card>
  <Card
    title="Monitoring guide"
    icon="chart-line"
    href="/guides/deployment/monitoring"
  >
    Set up monitoring
  </Card>
  <Card
    title="Security guide"
    icon="shield"
    href="/guides/self-hosting/security"
  >
    Secure your deployment
  </Card>
</CardGroup>
