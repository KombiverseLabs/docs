---
title: KombiSphere API overview
description: Central API gateway built on Kong OSS for unified microservice access
---

# KombiSphere API

KombiSphere API is the **central API gateway** built on Kong OSS. It provides a unified entry point for all microservices with authentication, rate limiting, and routing.

<CardGroup cols={2}>
  <Card
    title="Authentication"
    icon="key"
    href="/saas/api/authentication"
  >
    JWT and API key authentication
  </Card>
  <Card
    title="Rate limits"
    icon="gauge"
    href="/saas/api/rate-limits"
  >
    Endpoint-specific rate limiting
  </Card>
  <Card
    title="Endpoints"
    icon="route"
    href="/saas/api/endpoints"
  >
    API routes and services
  </Card>
  <Card
    title="gRPC support"
    icon="network-wired"
    href="/saas/api/endpoints#grpc-services"
  >
    Worker communication
  </Card>
</CardGroup>

## Architecture

```
                              ┌─────────────────────────────────────┐
                              │        Kong API Gateway             │
                              │         (kombisphere-kong)          │
                              │                                     │
    Internet ──────────────── │  :8000 (HTTP)  :8443 (HTTPS)       │
                              │  :9080 (gRPC)  :9443 (gRPC-TLS)    │
                              │  :8001 (Admin API - internal)       │
                              │                                     │
                              │  ┌───────────────────────────────┐ │
                              │  │        Global Plugins          │ │
                              │  │  • JWT (Zitadel OIDC)         │ │
                              │  │  • Key-Auth (API Keys)        │ │
                              │  │  • Rate Limiting              │ │
                              │  │  • Request Transformer        │ │
                              │  │  • CORS / Security Headers    │ │
                              │  └───────────────────────────────┘ │
                              └────────────┬────────────────────────┘
                                           │
              ┌────────────────────────────┼────────────────────────────┐
              │                            │                            │
              ▼                            ▼                            ▼
    ┌─────────────────┐          ┌─────────────────┐          ┌─────────────────┐
    │   KombiStack    │          │    KombiSim     │          │    StackKits    │
    │ /v1/orchestrator│          │  /v1/simulation │          │  /v1/stackkits  │
    │  HTTP: :8080    │          │   HTTP: :8081   │          │   HTTP: :8082   │
    │  gRPC: :50051   │          └─────────────────┘          └─────────────────┘
    └─────────────────┘
```

## Key features

<AccordionGroup>
  <Accordion title="JWT authentication" icon="shield-check">
    Zitadel OIDC integration for browser-based auth:
    
    ```http
    GET /v1/orchestrator/workflows HTTP/1.1
    Host: api.kombisphere.io
    Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...
    ```
  </Accordion>

  <Accordion title="API key management" icon="key">
    For external consumers and programmatic access:
    
    ```http
    GET /v1/orchestrator/workflows HTTP/1.1
    Host: api.kombisphere.io
    X-Api-Key: ks-xxxxx-xxxxx-xxxxx
    ```
  </Accordion>

  <Accordion title="Rate limiting" icon="gauge">
    Per-endpoint rate limits:
    
    | Endpoint | Limit (minute) | Limit (hour) | Limit (day) |
    |----------|----------------|--------------|-------------|
    | `/v1/orchestrator/ai/*` | 60 | 500 | 5,000 |
    | `/v1/orchestrator/*` | 300 | 5,000 | 50,000 |
    | `/v1/simulation/*` | 100 | 1,000 | 10,000 |
    | `/v1/stackkits/*` | 200 | 3,000 | 30,000 |
  </Accordion>

  <Accordion title="gRPC support" icon="network-wired">
    For worker registrations from remote homelabs:
    
    ```protobuf
    service WorkerService {
      rpc Register(RegisterRequest) returns (RegisterResponse);
      rpc Heartbeat(HeartbeatRequest) returns (HeartbeatResponse);
      rpc GetTasks(GetTasksRequest) returns (stream Task);
    }
    ```
  </Accordion>

  <Accordion title="Declarative configuration" icon="file-code">
    GitOps-friendly with decK:
    
    ```yaml
    # kong.yml
    _format_version: "3.0"
    
    services:
      - name: kombistack
        url: http://kombistack:8080
        routes:
          - name: orchestrator
            paths:
              - /v1/orchestrator
    ```
  </Accordion>
</AccordionGroup>

## Tech stack

| Component | Technology | Purpose |
|-----------|------------|---------|
| **Gateway** | Kong OSS 3.9 | API gateway |
| **Configuration** | decK | Declarative config |
| **Auth** | JWT Plugin | Token validation |
| **Monitoring** | Prometheus | Metrics export |

## Service ports

| Service | Port | Protocol | Description |
|---------|------|----------|-------------|
| HTTP | 8000 | HTTP | Public API |
| HTTPS | 8443 | HTTPS | Secure API |
| gRPC | 9080 | gRPC | Worker communication |
| gRPC-TLS | 9443 | gRPC | Secure worker communication |
| Admin API | 8001 | HTTP | Kong admin (internal only) |

## API routes

| Route | Method | Service | Description |
|-------|--------|---------|-------------|
| `/v1/orchestrator/*` | ALL | KombiStack | Orchestrator API |
| `/v1/orchestrator/ai/*` | ALL | KombiStack | AI endpoints (rate limited) |
| `/v1/simulation/*` | ALL | KombiSim | Simulation API |
| `/v1/stackkits/*` | ALL | StackKits | IaC/CUE Logic API |
| `/health` | GET | KombiStack | Health check (public) |
| `/grpc/*` | gRPC | KombiStack | gRPC services |

## Authentication methods

### 1. JWT (Zitadel OIDC)

Used for browser-based authentication via SSO.

**Flow:**

```mermaid
sequenceDiagram
    participant Browser
    participant Kong
    participant Zitadel
    participant Backend
    
    Browser->>Kong: Request with JWT
    Kong->>Zitadel: Validate token
    Zitadel-->>Kong: Token valid
    Kong->>Kong: Add X-User-ID header
    Kong->>Backend: Forward request
    Backend-->>Kong: Response
    Kong-->>Browser: Response
```

**Headers:**

```http
Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...
```

**Kong adds:**

```http
X-User-ID: 123
X-User-Email: user@example.com
X-Org-ID: org-456
```

### 2. API Key (Key-Auth)

Used for programmatic access from external systems.

**Headers:**

```http
X-Api-Key: ks-xxxxx-xxxxx-xxxxx
```

**Kong adds:**

```http
X-Consumer-ID: consumer-123
X-Consumer-Username: my-integration
```

## Rate limiting

### Global limits

```yaml
rate_limiting:
  minute: 300
  hour: 5000
  day: 50000
  policy: local
```

### Per-endpoint limits

```yaml
# AI endpoints (more restrictive)
- name: ai-rate-limit
  route: /v1/orchestrator/ai/*
  config:
    minute: 60
    hour: 500
    day: 5000

# Simulation endpoints
- name: simulation-rate-limit
  route: /v1/simulation/*
  config:
    minute: 100
    hour: 1000
    day: 10000
```

## Configuration management

### Using decK

```bash
# Validate configuration
deck validate --state kong.yml

# Sync to Kong
deck sync --kong-addr http://localhost:8001 --state kong.yml

# Dump current config
deck dump --kong-addr http://localhost:8001 -o kong-dump.yml
```

### Example configuration

```yaml
# kong.yml
_format_version: "3.0"

services:
  - name: kombistack
    url: http://kombistack:8080
    routes:
      - name: orchestrator
        paths:
          - /v1/orchestrator
        plugins:
          - name: jwt
            config:
              uri_param_names:
                - jwt
          - name: rate-limiting
            config:
              minute: 300
              hour: 5000

  - name: kombisim
    url: http://kombisim:8081
    routes:
      - name: simulation
        paths:
          - /v1/simulation
        plugins:
          - name: jwt
          - name: rate-limiting
            config:
              minute: 100
              hour: 1000
```

## Monitoring

### Prometheus metrics

Metrics are exposed at `http://localhost:8001/metrics`:

```yaml
# Example Prometheus scrape config
scrape_configs:
  - job_name: 'kong'
    static_configs:
      - targets: ['kombisphere-kong:8001']
    metrics_path: /metrics
```

**Key metrics:**

- `kong_http_requests_total` - Total HTTP requests
- `kong_http_status` - HTTP status codes
- `kong_latency` - Request latency
- `kong_bandwidth` - Bandwidth usage

### Health checks

```bash
# Kong health
curl http://localhost:8001/status

# Upstream health
curl http://localhost:8001/upstreams/kombistack-upstream/health
```

## Security

<CardGroup cols={2}>
  <Card title="Never expose Admin API" icon="shield-halved">
    Port 8001 should be internal only
  </Card>
  <Card title="Rotate API keys" icon="rotate">
    Regular key rotation for security
  </Card>
  <Card title="Use TLS in production" icon="lock">
    HTTPS and gRPC-TLS for all traffic
  </Card>
  <Card title="Enable audit logging" icon="file-text">
    Track all API access
  </Card>
</CardGroup>

## License

MIT License - see [LICENSE](https://github.com/KombiverseLabs/KombiSphere-API/blob/main/LICENSE)

## Next steps

<CardGroup cols={2}>
  <Card
    title="Authentication"
    icon="key"
    href="/saas/api/authentication"
  >
    Learn about JWT and API keys
  </Card>
  <Card
    title="Rate limits"
    icon="gauge"
    href="/saas/api/rate-limits"
  >
    Understand rate limiting
  </Card>
  <Card
    title="Endpoints"
    icon="route"
    href="/saas/api/endpoints"
  >
    Explore API routes
  </Card>
  <Card
    title="Deployment guide"
    icon="rocket"
    href="/guides/deployment/production-checklist"
  >
    Deploy to production
  </Card>
</CardGroup>
