---
title: Hybrid infrastructure
description: Manage both cloud VPS and local servers in a unified control plane
---


kombify Cloud enables you to manage **cloud VPS** and **local home servers** as a single logical infrastructure, with secure networking and unified configuration.

## What is hybrid infrastructure?

Traditional infrastructure management treats cloud and on-premises as separate worlds. kombify Cloud unifies them:

<CardGroup cols={2}>
  <Card title="Cloud resources" icon="cloud">
    VPS instances from Hetzner, AWS, Azure, or any cloud provider
  </Card>
  <Card title="Local resources" icon="server">
    Physical servers, Raspberry Pis, NAS devices in your homelab
  </Card>
</CardGroup>

**Result:** One spec file, one control plane, one network mesh.

## Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         kombify Cloud CONTROL PLANE                            â”‚
â”‚                              (KombiStack Core)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                             â”‚
              â–¼                             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Cloud Nodes    â”‚           â”‚  Local Nodes    â”‚
    â”‚  (VPS)          â”‚           â”‚  (Homelab)      â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ â€¢ Hetzner VPS   â”‚           â”‚ â€¢ Main Server   â”‚
    â”‚ â€¢ AWS EC2       â”‚           â”‚ â€¢ Raspberry Pi  â”‚
    â”‚ â€¢ Azure VM      â”‚           â”‚ â€¢ NAS Device    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                             â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚  Headscale VPN  â”‚
                  â”‚  (Mesh Network) â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Node types

kombify Cloud distinguishes between different node types:

| Type | Location | Provider | Use case |
|------|----------|----------|----------|
| **VPS** | Cloud | `hetzner`, `aws`, `azure` | Public-facing services, edge locations |
| **Local** | Homelab | `local` | Private services, storage, compute |
| **Hybrid** | Both | Mixed | Distributed applications |

## Example: Hybrid setup

```yaml kombination.yaml
version: "1.0"
name: hybrid-homelab
kit: modern-homelab

nodes:
  # Cloud VPS for public services
  - name: vps-web
    type: main
    provider: hetzner
    location: nbg1
    size: cx11
    ssh:
      user: root
    
  # Local server for private services
  - name: local-storage
    type: worker
    provider: local
    ssh:
      host: 192.168.1.100
      user: admin
  
  # Local compute node
  - name: local-compute
    type: worker
    provider: local
    ssh:
      host: 192.168.1.101
      user: admin

services:
  # Public services on VPS
  - name: traefik
    node: vps-web
    type: reverse-proxy
    config:
      public_domain: myapp.com
  
  # Private services on local
  - name: plex
    node: local-storage
    type: media-server
  
  - name: nextcloud
    node: local-storage
    type: file-sync
```

## Secure networking with Headscale

kombify Cloud uses [Headscale](https://github.com/juanfont/headscale) (self-hosted Tailscale) to create a secure mesh network between all nodes.

### How it works

<Steps>
  <Step title="Headscale deployment">
    KombiStack automatically deploys Headscale on your main node:
    
    ```yaml
    services:
      - name: headscale
        type: vpn-control-plane
        auto_deploy: true
    ```
  </Step>

  <Step title="Node registration">
    Each node registers with Headscale and receives a WireGuard configuration:
    
    ```bash
    # Automatic during provisioning
    headscale nodes register --user homelab
    ```
  </Step>

  <Step title="Mesh connectivity">
    All nodes can communicate securely via their Headscale IPs:
    
    ```
    vps-web:        100.64.0.1
    local-storage:  100.64.0.2
    local-compute:  100.64.0.3
    ```
  </Step>
</Steps>

### Benefits

<CardGroup cols={2}>
  <Card title="Zero-trust security" icon="shield-check">
    Encrypted WireGuard tunnels between all nodes
  </Card>
  <Card title="NAT traversal" icon="network-wired">
    Access local nodes from anywhere without port forwarding
  </Card>
  <Card title="Private networking" icon="lock">
    Services communicate over private mesh, not public internet
  </Card>
  <Card title="Self-hosted" icon="server">
    No reliance on Tailscale cloud infrastructure
  </Card>
</CardGroup>

## Provider support

### Supported providers

| Provider | Status | Node types | Authentication |
|----------|--------|------------|----------------|
| **Local** | âœ… Stable | Physical servers, VMs | SSH key |
| **Hetzner Cloud** | ğŸŸ¡ Planned | VPS | API token |
| **AWS** | ğŸŸ¡ Planned | EC2 | IAM credentials |
| **Azure** | ğŸŸ¡ Planned | VMs | Service principal |
| **Docker** | âœ… Stable | Containers | Docker socket |

### Provider configuration

<CodeGroup>
```yaml Local provider
nodes:
  - name: homelab-server
    provider: local
    ssh:
      host: 192.168.1.100
      user: admin
      key_path: ~/.ssh/id_ed25519
```

```yaml Hetzner provider (planned)
nodes:
  - name: hetzner-vps
    provider: hetzner
    location: nbg1
    size: cx11
    image: ubuntu-24.04
    ssh:
      user: root
```

```yaml AWS provider (planned)
nodes:
  - name: aws-instance
    provider: aws
    region: us-east-1
    instance_type: t3.micro
    ami: ami-0c55b159cbfafe1f0
```
</CodeGroup>

## Use cases

### 1. Public web + private storage

```yaml
# VPS for public-facing web services
- name: vps-web
  provider: hetzner
  services: [traefik, web-app]

# Local NAS for storage
- name: local-nas
  provider: local
  services: [nextcloud, plex]
```

**Why:** Keep sensitive data at home, serve public content from cloud

### 2. Edge computing

```yaml
# Multiple edge locations
- name: edge-us-east
  provider: aws
  region: us-east-1

- name: edge-eu-west
  provider: hetzner
  location: nbg1

# Central homelab for management
- name: homelab-control
  provider: local
```

**Why:** Low-latency access for users in different regions

### 3. Hybrid Kubernetes

```yaml
# Cloud control plane
- name: k8s-control-1
  provider: hetzner
  services: [k3s-server]

# Local worker nodes
- name: k8s-worker-1
  provider: local
  services: [k3s-agent]
```

**Why:** Managed control plane, local compute for cost savings

## Networking considerations

### Firewall rules

KombiStack automatically configures firewalls based on service requirements:

```yaml
services:
  - name: traefik
    type: reverse-proxy
    firewall:
      allow:
        - port: 80
          source: 0.0.0.0/0
        - port: 443
          source: 0.0.0.0/0
        - port: 8080
          source: 100.64.0.0/10  # Headscale mesh only
```

### DNS management

<Tabs>
  <Tab title="Public DNS">
    For cloud nodes with public IPs:
    
    ```yaml
    services:
      - name: traefik
        config:
          domain: myapp.com
          dns_provider: cloudflare
          dns_api_token: ${CLOUDFLARE_TOKEN}
    ```
  </Tab>

  <Tab title="Local DNS">
    For homelab nodes:
    
    ```yaml
    services:
      - name: traefik
        config:
          domain: homelab.local
          dns_provider: local
    ```
  </Tab>

  <Tab title="Split DNS">
    Different domains for public and private:
    
    ```yaml
    services:
      - name: traefik
        config:
          public_domain: myapp.com
          private_domain: homelab.local
    ```
  </Tab>
</Tabs>

## Best practices

<AccordionGroup>
  <Accordion title="Use VPS for public services" icon="cloud">
    Deploy public-facing services (web apps, APIs) on cloud VPS for:
    - Better uptime (no home internet dependency)
    - DDoS protection
    - Geographic distribution
  </Accordion>

  <Accordion title="Keep sensitive data local" icon="lock">
    Store personal data, backups, and media on local servers:
    - Full control over data
    - No cloud storage costs
    - Faster local access
  </Accordion>

  <Accordion title="Use Headscale for all communication" icon="network-wired">
    Route all inter-node traffic through the VPN mesh:
    - Encrypted by default
    - Works across NAT
    - No exposed ports
  </Accordion>

  <Accordion title="Implement health checks" icon="heart-pulse">
    Monitor connectivity between cloud and local nodes:
    
    ```yaml
    monitoring:
      health_checks:
        - name: vpn-connectivity
          type: ping
          targets: [vps-web, local-storage]
          interval: 60s
    ```
  </Accordion>
</AccordionGroup>

## Next steps

<CardGroup cols={2}>
  <Card
    title="StackKits system"
    icon="boxes-stacked"
    href="/concepts/stackkits"
  >
    Learn about infrastructure blueprints
  </Card>
  <Card
    title="Simulation first"
    icon="flask"
    href="/concepts/simulation-first"
  >
    Test hybrid setups with KombiSim
  </Card>
  <Card
    title="Deploy hybrid infrastructure"
    icon="rocket"
    href="/tools/kombistack/quickstart"
  >
    Follow the KombiStack quickstart
  </Card>
  <Card
    title="Networking guide"
    icon="network-wired"
    href="/guides/deployment/monitoring"
  >
    Configure VPN and networking
  </Card>
</CardGroup>
